<?xml version='1.0' encoding='utf-8'?>
<odoo>
    <record id="sale_order_form" model="ir.ui.view">
        <field name="name">sale.order.form</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form" />
        <field name="arch" type="xml">

            <xpath expr='/form/sheet/notebook' position="before">
                <div attrs="{'readonly': [('invoice_count', '>', 0)]}">
                    <field name="is_advance_invoice" />
                    <label for="is_advance_invoice" />
                </div>
            </xpath>
            <xpath expr="//page[@name='order_lines']" position="after">
                <page string="Facturas de Anticipo" attrs="{'invisible':[('is_advance_invoice', '=', False)]}">
                    <field name="invoice_advance_ids" >
                        <tree create="true" delete="true" edit="true" editable="bottom">
                            <field name="name"/>
                            <field name="partner_id" invisible="1"/>
                            <field name="invoice_id" />
                            <field name="advance_remaining_amount" force_save="1" readonly="1"/>
                            <field name="amount" attrs="{'readonly': [('confirmed', '=', True)]}"/>
                            <field name="percentage" invisible="1"/>
                            
                            <field name="confirmed" readonly="1"/>
                            <button name="confirm_advance" type="object"  class="oe_highlight" string="Confirmar Anticipo" attrs="{'invisible':[('confirmed', '=', True)]}"/>
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>
</odoo>